@page "/edit-product/{Id:guid}"
@using OrderDeliverySystem.AdministrationPanel.Services.Catalog.Models
@using Microsoft.AspNetCore.Components
@using OrderDeliverySystem.AdministrationPanel.Services.Contracts
@inject NavigationManager Navigation
@inject ICatalogService CatalogService
@attribute [StreamRendering]
@rendermode InteractiveServer

@code {
    [Parameter]
    public Guid Id { get; set; }

    private EditCatalogItemRequest EditItemRequest { get; set; }
    private CatalogItemResponce CatalogItemResponce { get; set; } = new CatalogItemResponce();

    private bool isLoading = true;
    protected override async Task OnInitializedAsync()
    {
        // var requestId = Guid.Parse(Id);

        CatalogItemResponce = await CatalogService.GetCatalogItemById(Id);

        EditItemRequest = new EditCatalogItemRequest()
        {
                CatalogItemId = Id,
                Name = CatalogItemResponce.Name,
                TimeToItemExist = CatalogItemResponce.Day,
                Description = CatalogItemResponce.Description,
                Price = CatalogItemResponce.Price,
                PictureUri = CatalogItemResponce.ImageUri
        };

        isLoading = false;
    }

    private async Task SaveItem()
    {
        isLoading = true;
        await CatalogService.UpdateItemAsync(EditItemRequest);
        isLoading = false;
        Navigation.NavigateTo("/menu");
    }
}

@if (isLoading)
{
    <p>Loading...</p>
}
else
{

    @if (!string.IsNullOrEmpty(EditItemRequest.PictureUri))
    {
        <div class="form-group">
            <label for="imagePreview">Image Preview</label>
            <img id="imagePreview" src="@EditItemRequest.PictureUri" alt="Image Preview" class="img-thumbnail" />
        </div>
    }


    <div class="container">
        <h3>Edit Catalog Item</h3>
        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" class="form-control" @bind="EditItemRequest.Name" />
        </div>
        <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" class="form-control" @bind="EditItemRequest.Description"></textarea>
        </div>
        <div class="form-group">
            <label for="price">Price</label>
            <input type="number" id="price" class="form-control" @bind="EditItemRequest.Price" />
        </div>
        <div class="form-group">
            <label for="imageUri">Image URL</label>
            <input type="text" id="imageUri" class="form-control" @bind="EditItemRequest.PictureUri" />
        </div>
        <div class="form-group">
            <label for="timeToItemExist">TimeToItemExist</label>
            <input type="date" id="timeToItemExist" class="form-control" @bind="EditItemRequest.TimeToItemExist" />
        </div>
        <button class="btn btn-primary" @onclick="SaveItem">Save</button>
    </div>
}

<style>

    .form-group {
        margin-bottom: 15px;
    }

    .img-thumbnail {
        max-width: 100%;
        height: auto;
        display: block;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        .container

    {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .form-group {
        margin-bottom: 15px;
    }

        .form-group label {
            font-weight: bold;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

    .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
        padding: 10px 20px;
        font-size: 1rem;
    }
</style>